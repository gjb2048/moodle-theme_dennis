Ref: https://docs.moodle.org/dev/PHPUnit

Ensure (as per Moodle dev doc above), for example:

$CFG->phpunit_prefix = 'phpu_';
$CFG->phpunit_dataroot = 'F:\\moodledev\\moodlebitesphpudata';

is set in the config.php file and that the 'phpunit_dataroot' directory exists.

Linux / Mac:

Have the parent dir of 'moodle' (where the code is) owned by the same user and group as 'moodle' like 'www-data'.
If you gave a different user on your install to 'www-data' then use that instead.

composer install

or

sudo -u www-data composer install --no-plugins --no-scripts

Update:

sudo -u www-data composer update --no-plugins --no-scripts

Upgrade to composer 2:

Ref: https://blog.packagist.com/composer-2-0-is-now-available/ then to https://getcomposer.org/download/ to run the php scripts, e.g:

php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php -r "if (hash_file('sha384', 'composer-setup.php') === '756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"

Make sure you use their script!  The above is only an example!

then:

which composer

then:

sudo php composer-setup.php --install-dir /usr/bin --filename composer


Ref: https://getcomposer.org/root

sudo -u www-data php admin/tool/phpunit/cli/init.php

sudo -u www-data vendor/bin/phpunit --filter theme_dennis_test

or

sudo -u www-data vendor/bin/phpunit theme/dennis/tests/theme_dennis_test.php

Drop tables:

sudo -u www-data php admin/tool/phpunit/cli/util.php --drop


Windows:

"Download Composer-Setup.exe from http://getcomposer.org/download/ and install it",
Ref: https://docs.moodle.org/dev/PHPUnit_installation_in_Windows#Install_Composer_dependency_manager

In the Moodle root:

composer install

php admin/tool/phpunit/cli/init.php

vendor\bin\phpunit theme/dennis/tests/theme_dennis_test.php

or:

vendor\bin\phpunit --filter theme_dennis_test

Ref: https://moodle.org/mod/forum/discuss.php?d=412355

You can also use the same phpunit / php commands on Windows too as per Linux / Mac.  Just change the direction of the directory delimiter as required.

Note:

When running on Linux if you get:

    Required locale 'en_AU.UTF-8' is not installed.

when '[sudo] php admin/tool/phpunit/cli/init.php' and Moodle is showing:

    Your server does not seem to fully support the following languages:

    English ‎(en)‎

    Instead, the global locale (en_AU.UTF-8) will be used to format certain strings such as dates or numbers.

on 'Dashboard -> Site administration -> Language -> Language packs', then do:

    sudo apt install language-pack-en

then:

    sudo service apache2 reload

Ref: https://moodle.org/mod/forum/discuss.php?d=390750
